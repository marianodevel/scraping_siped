============================= test session starts ==============================
platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
driver: Chrome
sensitiveurl: .*
rootdir: /home/mariano/scraping_siped
configfile: pytest.ini
plugins: variables-3.1.0, flask-1.3.0, pyfakefs-5.10.2, metadata-3.1.1, html-4.1.1, selenium-4.1.0, base-url-2.1.0, mock-3.15.1
collected 29 items

tests/e2e/test_app.py EEEEE                                              [ 17%]
tests/e2e/test_frontend.py EEEE                                          [ 31%]
tests/integration/test_fases.py ....                                     [ 44%]
tests/integration/test_gestor_almacenamiento.py .                        [ 48%]
tests/integration/test_gestor_tareas.py .....                            [ 65%]
tests/unit/test_parsers.py ..F..FF..F                                    [100%]

==================================== ERRORS ====================================
_______________________ ERROR at setup of test_login_get _______________________
file /home/mariano/scraping_siped/tests/e2e/test_app.py, line 8
  def test_login_get(client):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py, line 111
  @pytest.fixture(autouse=True)
  def _configure_application(request, monkeypatch):
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py:111
__________________ ERROR at setup of test_login_post_fallido ___________________
file /home/mariano/scraping_siped/tests/e2e/test_app.py, line 15
  def test_login_post_fallido(client, mocker):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py, line 111
  @pytest.fixture(autouse=True)
  def _configure_application(request, monkeypatch):
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py:111
______________ ERROR at setup of test_login_post_exitoso_y_logout ______________
file /home/mariano/scraping_siped/tests/e2e/test_app.py, line 32
  def test_login_post_exitoso_y_logout(client, mocker):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py, line 111
  @pytest.fixture(autouse=True)
  def _configure_application(request, monkeypatch):
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py:111
______________ ERROR at setup of test_rutas_protegidas_sin_login _______________
file /home/mariano/scraping_siped/tests/e2e/test_app.py, line 70
  def test_rutas_protegidas_sin_login(client):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py, line 111
  @pytest.fixture(autouse=True)
  def _configure_application(request, monkeypatch):
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py:111
_____________________ ERROR at setup of test_iniciar_fase ______________________
file /home/mariano/scraping_siped/tests/e2e/test_app.py, line 97
  def test_iniciar_fase(client, mocker):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py, line 111
  @pytest.fixture(autouse=True)
  def _configure_application(request, monkeypatch):
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/plugin.py:111
______________ ERROR at setup of test_flujo_login_y_arrancar_fase ______________
file /home/mariano/scraping_siped/tests/e2e/test_frontend.py, line 48
  def test_flujo_login_y_arrancar_fase(selenium, live_server):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py, line 40
  @pytest.fixture(scope=_determine_scope)
  def live_server(request, app, pytestconfig):  # pragma: no cover
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, reset_server_state, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py:40
__________ ERROR at setup of test_flujo_completo_de_estado_ui_polling __________
file /home/mariano/scraping_siped/tests/e2e/test_frontend.py, line 128
  def test_flujo_completo_de_estado_ui_polling(selenium, live_server):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py, line 40
  @pytest.fixture(scope=_determine_scope)
  def live_server(request, app, pytestconfig):  # pragma: no cover
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, reset_server_state, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py:40
_______________ ERROR at setup of test_race_condition_doble_clic _______________
file /home/mariano/scraping_siped/tests/e2e/test_frontend.py, line 226
  def test_race_condition_doble_clic(selenium, live_server):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py, line 40
  @pytest.fixture(scope=_determine_scope)
  def live_server(request, app, pytestconfig):  # pragma: no cover
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, reset_server_state, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py:40
______ ERROR at setup of test_consecutive_phase_launch_and_button_disable ______
file /home/mariano/scraping_siped/tests/e2e/test_frontend.py, line 271
  def test_consecutive_phase_launch_and_button_disable(live_server, selenium):
file /home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py, line 40
  @pytest.fixture(scope=_determine_scope)
  def live_server(request, app, pytestconfig):  # pragma: no cover
E       fixture 'app' not found
>       available fixtures: _configure_application, _monkeypatch_response_class, _push_request_context, _skip_sensitive, _verify_url, accept_any, accept_json, accept_jsonp, accept_mimetype, base_url, cache, capabilities, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, chrome_options, chrome_service, class_mocker, client, client_class, config, doctest_namespace, driver, driver_args, driver_class, driver_kwargs, driver_log, driver_path, edge_options, edge_service, extra, extras, firefox_options, firefox_service, fs, fs_class, fs_module, fs_session, html_ajax_movimientos, html_detalle_expediente, html_lista_expedientes_pagina_1, html_lista_expedientes_pagina_final, html_login_refresh, html_menu_principal, html_pagina_documento_pdfs, ie_options, ie_service, include_metadata_in_junit_xml, live_server, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, remote_options, reset_server_state, safari_options, safari_service, selenium, sensitive_url, session_capabilities, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, variables
>       use 'pytest --fixtures [testpath]' for help on them.

/home/mariano/scraping_siped/.venv/lib/python3.13/site-packages/pytest_flask/fixtures.py:40
=================================== FAILURES ===================================
________________________ test_parsear_lista_expedientes ________________________

html_lista_expedientes_pagina_1 = '\n    <html><body>\n        <table class="table-striped">\n            <tr><td>Expediente</td><td>Caratula</td><td>..... <button onclick="document.form.inicio.value=10; document.form.submit();">SIGUIENTE</button>\n    </body></html>\n    '

    def test_parsear_lista_expedientes(html_lista_expedientes_pagina_1):
        expedientes = parsers.parsear_lista_expedientes(html_lista_expedientes_pagina_1)
>       assert len(expedientes) == 1
E       assert 0 == 1
E        +  where 0 = len([])

tests/unit/test_parsers.py:24: AssertionError
____________________ test_parsear_detalle_para_ajax_params _____________________

html_detalle_expediente = '\n    <html><head><script>\n        var dependencia_ide=12; var tj_fuero=3; var exp_organismo_origen=45;\n    </script></head><body><form name="form"><input type="hidden" name="id" value="100"></form></body></html>\n    '

    def test_parsear_detalle_para_ajax_params(html_detalle_expediente):
        params = parsers.parsear_detalle_para_ajax_params(html_detalle_expediente)
        assert params["exp_id"] == "100"
>       assert params["dependencia_ide"] == "12"
               ^^^^^^^^^^^^^^^^^^^^^^^^^
E       KeyError: 'dependencia_ide'

tests/unit/test_parsers.py:51: KeyError
____________________ test_parsear_movimientos_de_ajax_html _____________________

html_ajax_movimientos = '\n    <table class="table-hover"><tbody><tr>\n        <td>1</td>\n        <td><form action="https://intranet.jussanta...     <td>PUBLICADO</td>\n        <td>USER</td><td>DESC</td><td>DATE</td><td>DATE</td>\n    </tr></tbody></table>\n    '

    def test_parsear_movimientos_de_ajax_html(html_ajax_movimientos):
        movimientos = parsers.parsear_movimientos_de_ajax_html(
            html_ajax_movimientos, "EXP-100/2025"
        )
>       assert len(movimientos) == 1
E       assert 0 == 1
E        +  where 0 = len([])

tests/unit/test_parsers.py:60: AssertionError
___________________ test_parsear_pagina_documento_pdf_links ____________________

html_pagina_documento_pdfs = '\n    <html>\n    <body>\n        <div class="titulo">\n            <h2>Expediente: EXP-100/2025</h2>\n        </div>... <tr><td>JUEZ</td><td>DR. MARIANO DEVEL</td><td>01/01/2025</td></tr>\n        </table>\n    </body>\n    </html>\n    '

    def test_parsear_pagina_documento_pdf_links(html_pagina_documento_pdfs):
        """
        Prueba la nueva lógica de parsing con el fixture actualizado.
        """
        data = parsers.parsear_pagina_documento(html_pagina_documento_pdfs)
    
        # 1. Verificar metadatos (extraídos del div.titulo o fallback)
>       assert data["expediente_nro"] == "EXP-100/2025"
E       AssertionError: assert 'Expediente: EXP-100/2025' == 'EXP-100/2025'
E         
E         - EXP-100/2025
E         + Expediente: EXP-100/2025

tests/unit/test_parsers.py:128: AssertionError
=========================== short test summary info ============================
FAILED tests/unit/test_parsers.py::test_parsear_lista_expedientes - assert 0 ...
FAILED tests/unit/test_parsers.py::test_parsear_detalle_para_ajax_params - Ke...
FAILED tests/unit/test_parsers.py::test_parsear_movimientos_de_ajax_html - as...
FAILED tests/unit/test_parsers.py::test_parsear_pagina_documento_pdf_links - ...
ERROR tests/e2e/test_app.py::test_login_get
ERROR tests/e2e/test_app.py::test_login_post_fallido
ERROR tests/e2e/test_app.py::test_login_post_exitoso_y_logout
ERROR tests/e2e/test_app.py::test_rutas_protegidas_sin_login
ERROR tests/e2e/test_app.py::test_iniciar_fase
ERROR tests/e2e/test_frontend.py::test_flujo_login_y_arrancar_fase
ERROR tests/e2e/test_frontend.py::test_flujo_completo_de_estado_ui_polling
ERROR tests/e2e/test_frontend.py::test_race_condition_doble_clic
ERROR tests/e2e/test_frontend.py::test_consecutive_phase_launch_and_button_disable
==================== 4 failed, 16 passed, 9 errors in 1.52s ====================
